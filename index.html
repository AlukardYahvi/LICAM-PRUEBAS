<!DOCTYPE html>
<html lang="es">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Calculadora de Riesgo CardiometabÃ³lico Integral (v2.5 - DiseÃ±o Profesional)</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
    <!-- Se recomienda incluir Font Awesome para los Ã­conos de forma externa si es posible -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
Â  Â  <style>
Â  Â  Â  Â  /* Estilos base y variables de diseÃ±o */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6; /* Fondo mÃ¡s claro y moderno */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* IPN Accent */
Â  Â  Â  Â  .ipn-accent { color: #b91c1c; } /* Rojo Guinda */
Â  Â  Â  Â  .ipn-bg { background-color: #b91c1c; }
        .ipn-border { border-color: #b91c1c; }
        .ipn-shadow { box-shadow: 0 4px 6px -1px rgba(185, 28, 28, 0.1), 0 2px 4px -2px rgba(185, 28, 28, 0.06); }

        /* Estilo del contenedor principal */
Â  Â  Â  Â  .main-container {
Â  Â  Â  Â  Â  Â  max-width: 1200px;
Â  Â  Â  Â  Â  Â  margin-left: auto;
Â  Â  Â  Â  Â  Â  margin-right: auto;
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  padding: 2.5rem; 
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.15); /* Sombra suave y elevada */
Â  Â  Â  Â  Â  Â  border-top: 8px solid #b91c1c; 
Â  Â  Â  Â  }
        
        /* Estilos especÃ­ficos del Aviso de Privacidad como card flotante */
        #privacy-disclaimer {
            position: relative;
            padding: 3rem;
            border: 3px solid #b91c1c;
            background-color: #fffcfc;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .disclaimer-content {
            max-height: 450px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            border-radius: 0.75rem;
            background-color: #f9fafb;
            font-size: 0.9rem;
        }

        /* Estilos para inputs y selects */
        input[type="text"], input[type="number"], input[type="email"], input[type="date"], select {
            border: 1px solid #d1d5db;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="email"]:focus, input[type="date"]:focus, select:focus {
            border-color: #b91c1c;
            box-shadow: 0 0 0 2px rgba(185, 28, 28, 0.3);
        }

        /* Paleta de riesgo (mantener) */
Â  Â  Â  Â  .risk-low { background-color: #d1fae5; color: #065f46; border-color: #34d399; }
Â  Â  Â  Â  .risk-moderate { background-color: #fef3c7; color: #92400e; border-color: #fcd34d; }
Â  Â  Â  Â  .risk-high { background-color: #fee2e2; color: #991b1b; border-color: #f87171; }
Â  Â  Â  Â  .risk-very-high { background-color: #eeb8b8; color: #570a0a; border-color: #c95d5d; }

Â  Â  Â  Â  /* ==== SECCIÃ“N CSS DE IMPRESIÃ“N ==== */
Â  Â  Â  Â  @media print {
Â  Â  Â  Â  Â  Â  .no-print, #privacy-disclaimer { display: none !important; }
Â  Â  Â  Â  Â  Â  body { padding: 0; margin: 0; background-color: #ffffff; }
Â  Â  Â  Â  Â  Â  .main-container { max-width: 100% !important; box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; }
Â  Â  Â  Â  Â  Â  header, #results-section, #app-content { display: block !important; }
Â  Â  Â  Â  Â  Â  .risk-low, .risk-moderate, .risk-high, .risk-very-high {
Â  Â  Â  Â  Â  Â  Â  Â  -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; background-color: inherit;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  /* ==== FIN DE SECCIÃ“N DE IMPRESIÃ“N ==== */
Â  Â  </style>
</head>
<body class="p-4 md:p-8">

Â  Â  <div class="main-container">

        <!-- ======================================================= -->
        <!-- === INICIO: AVISO DE PRIVACIDAD (Se muestra primero) === -->
        <!-- ======================================================= -->
        <div id="privacy-disclaimer" class="no-print">
            <h1 class="text-3xl font-bold ipn-accent mb-4 text-center">
                ğŸ›¡ï¸ Aviso de Privacidad y Uso de Datos Personales
            </h1>
            <p class="text-sm text-gray-700 mb-6 text-center">
                El Laboratorio de InvestigaciÃ³n CardiometabÃ³lica (LICAM) del Instituto PolitÃ©cnico Nacional (IPN), con domicilio en <span class="font-semibold text-gray-800">[agregar direcciÃ³n oficial del laboratorio o campus correspondiente]</span>, es responsable del tratamiento de los datos personales que usted proporcione a travÃ©s de esta Calculadora de Riesgo CardiometabÃ³lico.
            </p>

            <div class="disclaimer-content text-sm text-gray-600 space-y-3">
                <p>
                    <span class="font-bold text-gray-800">Finalidad del tratamiento de los datos</span><br>
                    Los datos personales recabados â€”incluyendo informaciÃ³n general de salud, presiÃ³n arterial, niveles de glucosa, antecedentes mÃ©dicos, hÃ¡bitos de vida y otros parÃ¡metros biomÃ©tricosâ€” serÃ¡n utilizados Ãºnicamente con fines estadÃ­sticos, acadÃ©micos y de investigaciÃ³n cientÃ­fica relacionados con el estudio del riesgo cardiometabÃ³lico en la poblaciÃ³n. Dichos datos serÃ¡n analizados de forma anÃ³nima y confidencial, sin asociarse a informaciÃ³n que permita identificarle personalmente.
                </p>
                <p>
                    <span class="font-bold text-gray-800">Datos personales sensibles</span><br>
                    Debido a la naturaleza del estudio, se recaban datos personales sensibles relacionados con su estado de salud. Estos datos serÃ¡n protegidos bajo estrictas medidas de seguridad administrativas, tÃ©cnicas y fÃ­sicas para evitar su pÃ©rdida, alteraciÃ³n, destrucciÃ³n, uso indebido o acceso no autorizado.
                </p>
                <p>
                    <span class="font-bold text-gray-800">Transferencia y uso de la informaciÃ³n</span><br>
                    Sus datos no serÃ¡n compartidos con terceros ajenos al IPN o al LICAM sin su consentimiento expreso. En caso de que los resultados sean utilizados en publicaciones, presentaciones acadÃ©micas o reportes estadÃ­sticos, se emplearÃ¡n Ãºnicamente de forma agrupada y disociada, sin identificar individualmente a los participantes.
                </p>
                <p>
                    <span class="font-bold text-gray-800">Consentimiento</span><br>
                    Al utilizar esta calculadora y proporcionar sus datos, usted otorga su consentimiento informado para el tratamiento descrito anteriormente. Si no desea que sus datos sean tratados bajo estos tÃ©rminos, puede abstenerse de completar el formulario o solicitar la eliminaciÃ³n de su informaciÃ³n.
                </p>
                <p>
                    <span class="font-bold text-gray-800">Derechos ARCO (Acceso, RectificaciÃ³n, CancelaciÃ³n y OposiciÃ³n)</span><br>
                    Usted tiene derecho a acceder, rectificar, cancelar u oponerse al tratamiento de sus datos personales conforme a la Ley Federal de ProtecciÃ³n de Datos Personales en PosesiÃ³n de los Particulares. Para ejercer estos derechos, puede dirigir una solicitud al correo electrÃ³nico: <span class="font-semibold text-red-600">[correo institucional del LICAM o responsable del proyecto]</span>.
                </p>
                <p>
                    <span class="font-bold text-gray-800">Modificaciones al aviso de privacidad</span><br>
                    Cualquier cambio o actualizaciÃ³n al presente aviso se publicarÃ¡ en este mismo medio o en las plataformas oficiales del IPN.
                </p>
            </div>
            
            <p class="text-xs text-right text-gray-500 mt-4">
                ğŸ“… Ãšltima actualizaciÃ³n: [fecha de publicaciÃ³n]
            </p>

            <div class="mt-6 p-4 bg-gray-100 rounded-lg flex flex-col items-center">
                <label for="accept-checkbox" class="flex items-center space-x-2 cursor-pointer text-lg font-medium text-gray-800">
                    <input type="checkbox" id="accept-checkbox" class="h-5 w-5 text-red-600 rounded border-gray-300 focus:ring-red-500">
                    <span>He leÃ­do y acepto el Aviso de Privacidad.</span>
                </label>

                <button id="start-button" disabled class="mt-4 w-full sm:w-1/2 py-3 px-6 border border-transparent rounded-lg shadow-glow text-lg font-medium text-white ipn-bg opacity-50 cursor-not-allowed transition duration-150 ease-in-out">
                    Continuar al Calculador
                </button>
            </div>

            <p class="text-xs text-center text-gray-500 mt-4">
                Â© 2025 Laboratorio de InvestigaciÃ³n CardiometabÃ³lica (LICAM) â€“ Instituto PolitÃ©cnico Nacional
            </p>
        </div>
        <!-- ======================================================= -->
        <!-- === FIN: AVISO DE PRIVACIDAD === -->
        <!-- ======================================================= -->

        <!-- CONTENIDO PRINCIPAL (Se muestra despuÃ©s de aceptar) -->
        <div id="app-content" class="hidden">
Â  Â  Â  Â  <header class="mb-10 border-b pb-4">
            <div class="grid grid-cols-3 items-center justify-between gap-4">
                <!-- Columna 1: Logo ESM -->
                <div class="flex justify-start">
                    <a href="https://www.esm.ipn.mx/" target="_blank" title="Escuela Superior de Medicina - IPN">
                        <img src="logo_esm.png" alt="Logo ESM" class="h-16 w-16 md:h-20 md:w-20 object-contain shadow-md rounded-xl">
                    </a>
                </div>

                <!-- Columna 2: TÃ­tulo Central -->
                <div class="text-center col-span-1">
                    <h1 class="text-2xl md:text-3xl font-extrabold ipn-accent leading-tight">
                        Calculadora de Riesgo CardiometabÃ³lico
                    </h1>
                    <p class="text-sm md:text-md text-gray-700 mt-1 no-print">
                        Proyecto de Tesis - IngenierÃ­a en BiotecnologÃ­a
                    </p>
                </div>

                <!-- Columna 3: Logos IPN, LICAM y Mascota -->
                <div class="flex justify-end items-center space-x-2 sm:space-x-4">
                    
                    <!-- ESPACIO PARA MASCOTA -->
                    <div id="mascot-header" class="rounded-full overflow-hidden border-2 border-red-300 shadow-md hidden sm:block" title="Mascota LICAM">
                        <!-- Reemplaza la URL 'https://placehold.co/...' por la URL de tu imagen mascota_licam.png -->
                        <img src="https://placehold.co/60x60/d9534f/ffffff?text=MASCOTA" onerror="this.onerror=null;this.src='mascota_licam.png';" alt="Mascota del Proyecto" class="h-12 w-12 md:h-16 md:w-16 object-cover rounded-full">
                    </div>

                    <a href="https://www.ipn.mx/" target="_blank" title="Instituto PolitÃ©cnico Nacional">
                        <img src="logo_ipn.png" alt="Logo IPN" class="h-16 w-16 md:h-20 md:w-20 object-contain shadow-lg rounded-xl">
                    </a>
                    <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" title="Laboratorio LICAM" class="hidden sm:block">
                        <img src="logo_licam.png" alt="Logo LICAM" class="h-12 w-12 md:h-16 md:w-16 object-contain rounded-full shadow-md">
                    </a>
                </div>
            </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <form id="calc-form" class="no-print space-y-8">
Â  Â  Â  Â  Â  Â  <div id="validation-message" class="hidden p-3 mb-4 rounded-lg bg-red-100 text-red-700 font-semibold border-l-4 border-red-500"></div>
Â  Â  Â  Â  Â  Â  <div id="input-form">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 1: Datos Personales -->
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-50 p-6 rounded-xl shadow-lg space-y-6">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-user-circle mr-3 ipn-accent"></i> 1. Datos Personales</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="full_name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                            <input type="text" id="full_name" placeholder="Nombre(s) Apellido(s)" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="birth_date" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento</label>
                            <input type="date" id="birth_date" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-700">Sexo BiolÃ³gico</label>
                            <select id="gender" class="mt-1 block w-full">
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                            </select>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Correo ElectrÃ³nico (Opcional)</label>
                            <input type="email" id="email" placeholder="ejemplo@correo.com" class="mt-1 block w-full">
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 2: Signos Vitales y DinamometrÃ­a -->
                <div class="bg-white p-6 rounded-xl shadow-lg space-y-6 border-l-4 ipn-border">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-heartbeat mr-3 ipn-accent"></i> 2. Signos Vitales y DinamometrÃ­a</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="hr" class="block text-sm font-medium text-gray-700">Frec. CardÃ­aca (lpm)</label>
                            <input type="number" id="hr" placeholder="60-100" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="rr" class="block text-sm font-medium text-gray-700">Frec. Respiratoria (rpm)</label>
                            <input type="number" id="rr" placeholder="12-20" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="grip_right" class="block text-sm font-medium text-gray-700">Fuerza Agarre Der. (Kg)</label>
                            <input type="number" step="0.1" id="grip_right" placeholder="30.5" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="grip_left" class="block text-sm font-medium text-gray-700">Fuerza Agarre Izq. (Kg)</label>
                            <input type="number" step="0.1" id="grip_left" placeholder="29.8" class="mt-1 block w-full">
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-700 border-t pt-4 mt-4">2.1. PresiÃ³n Arterial (MediciÃ³n Principal)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="pas" class="block text-sm font-medium text-gray-700">PresiÃ³n SistÃ³lica (mmHg)</label>
                            <input type="number" id="pas" value="120" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="pad" class="block text-sm font-medium text-gray-700">PresiÃ³n DiastÃ³lica (mmHg)</label>
                            <input type="number" id="pad" value="80" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="pa_d2_s" class="block text-sm font-medium text-gray-700">PA DÃ­a 2 S/D (Opcional)</label>
                            <div class="flex space-x-2">
                                <input type="number" id="pa_d2_s" placeholder="SistÃ³lica" class="mt-1 block w-1/2">
                                <input type="number" id="pa_d2_d" placeholder="DiastÃ³lica" class="mt-1 block w-1/2">
                            </div>
                        </div>
                        <div>
                            <label for="pa_d3_s" class="block text-sm font-medium text-gray-700">PA DÃ­a 3 S/D (Opcional)</label>
                            <div class="flex space-x-2">
                                <input type="number" id="pa_d3_s" placeholder="SistÃ³lica" class="mt-1 block w-1/2">
                                <input type="number" id="pa_d3_d" placeholder="DiastÃ³lica" class="mt-1 block w-1/2">
                            </div>
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 3: AntropometrÃ­a -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg space-y-6">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-ruler-combined mr-3 ipn-accent"></i> 3. AntropometrÃ­a</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="height" class="block text-sm font-medium text-gray-700">Estatura (cm)</label>
                            <input type="number" id="height" value="170" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="weight" class="block text-sm font-medium text-gray-700">Peso (kg)</label>
                            <input type="number" id="weight" value="75" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="waist" class="block text-sm font-medium text-gray-700">PerÃ­metro Cintura (cm)</label>
                            <input type="number" id="waist" value="90" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="hip" class="block text-sm font-medium text-gray-700">PerÃ­metro Cadera (cm)</label>
                            <input type="number" id="hip" value="100" class="mt-1 block w-full">
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 4: ParÃ¡metros BioquÃ­micos -->
                <div class="bg-white p-6 rounded-xl shadow-lg space-y-6 border-l-4 ipn-border">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-flask mr-3 ipn-accent"></i> 4. ParÃ¡metros BioquÃ­micos</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="glucose" class="block text-sm font-medium text-gray-700">Glucosa Ayunas (mg/dL)</label>
                            <input type="number" id="glucose" value="90" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="hba1c" class="block text-sm font-medium text-gray-700">HbA1c (%) (Opcional)</label>
                            <input type="number" step="0.1" id="hba1c" placeholder="5.7" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="total_chol" class="block text-sm font-medium text-gray-700">Colesterol Total (mg/dL)</label>
                            <input type="number" id="total_chol" placeholder="180" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="hdl" class="block text-sm font-medium text-gray-700">Colesterol HDL (mg/dL)</label>
                            <input type="number" id="hdl" value="45" class="mt-1 block w-full">
                        </div>
                        <div class="lg:col-span-2">
                            <label for="ldl" class="block text-sm font-medium text-gray-700">Colesterol LDL (mg/dL)</label>
                            <input type="number" id="ldl" placeholder="110" class="mt-1 block w-full">
                        </div>
                        <div class="lg:col-span-2">
                            <label for="triglycerides" class="block text-sm font-medium text-gray-700">TriglicÃ©ridos (mg/dL)</label>
                            <input type="number" id="triglycerides" value="140" class="mt-1 block w-full">
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 5: ComposiciÃ³n Corporal (Opcional, BIA) -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg space-y-6">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-weight-hanging mr-3 ipn-accent"></i> 5. ComposiciÃ³n Corporal <span class="text-base text-gray-500 ml-2">(Opcional BIA)</span></h2>
                    <p class="text-sm text-gray-500 -mt-3 italic">Llenar solo si tiene datos de una bÃ¡scula de Bioimpedancia (BIA).</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6">
                        <div>
                            <label for="bia_fat_p" class="block text-sm font-medium text-gray-700">% Grasa Corporal</label>
                            <input type="number" step="0.1" id="bia_fat_p" placeholder="25.5" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="bia_muscle_p" class="block text-sm font-medium text-gray-700">% MÃºsculo</label>
                            <input type="number" step="0.1" id="bia_muscle_p" placeholder="34.0" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="bia_visceral_p" class="block text-sm font-medium text-gray-700">% Grasa Visceral</label>
                            <input type="number" step="0.1" id="bia_visceral_p" placeholder="9" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="bia_water_p" class="block text-sm font-medium text-gray-700">% Agua</label>
                            <input type="number" step="0.1" id="bia_water_p" placeholder="55.0" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="bia_metabolic_age" class="block text-sm font-medium text-gray-700">Edad MetabÃ³lica</label>
                            <input type="number" id="bia_metabolic_age" placeholder="40" class="mt-1 block w-full">
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 6: Estilo de Vida -->
                <div class="bg-white p-6 rounded-xl shadow-lg space-y-6 border-l-4 ipn-border">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-walking mr-3 ipn-accent"></i> 6. Estilo de Vida</h2>
                    
                    <h3 class="text-xl font-semibold text-gray-700 border-b pb-1">6.1. Actividad FÃ­sica</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="activity_days" class="block text-sm font-medium text-gray-700">DÃ­as de ejercicio/semana</label>
                            <select id="activity_days" class="mt-1 block w-full">
                                <option value="0">0 (Sedentario)</option>
                                <option value="2">1-2 dÃ­as</option>
                                <option value="3.5">3-4 dÃ­as</option>
                                <option value="5">5 o mÃ¡s dÃ­as</option>
                            </select>
                        </div>
                        <div>
                            <label for="activity_duration" class="block text-sm font-medium text-gray-700">DuraciÃ³n promedio (min/dÃ­a)</label>
                            <input type="number" id="activity_duration" placeholder="30" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="activity_intensity" class="block text-sm font-medium text-gray-700">Intensidad Principal</label>
                            <select id="activity_intensity" class="mt-1 block w-full">
                                <option value="light">Ligera (Caminar)</option>
                                <option value="moderate">Moderada (Trotar, Bici)</option>
                                <option value="vigorous">Vigorosa (Correr, HIIT)</option>
                            </select>
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 border-b pt-4 pb-1">6.2. Tabaquismo</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div>
                            <label for="smoker_status" class="block text-sm font-medium text-gray-700">Estado</label>
                            <select id="smoker_status" class="mt-1 block w-full">
                                <option value="never">Nunca he fumado</option>
                                <option value="ex_smoker">Ex-fumador</option>
                                <option value="active">Fumador Actual</option>
                            </select>
                        </div>
                        <div>
                            <label for="smoker_passive" class="block text-sm font-medium text-gray-700">Fumador Pasivo</label>
                            <select id="smoker_passive" class="mt-1 block w-full">
                                <option value="no">No</option>
                                <option value="yes">SÃ­ (convive con fumadores)</option>
                            </select>
                        </div>
                        <div>
                            <label for="smoker_years" class="block text-sm font-medium text-gray-700">AÃ±os fumando (si aplica)</label>
                            <input type="number" id="smoker_years" placeholder="10" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="smoker_daily_avg" class="block text-sm font-medium text-gray-700">Cigarrillos/dÃ­a (promedio)</label>
                            <input type="number" id="smoker_daily_avg" placeholder="5" class="mt-1 block w-full">
                        </div>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-700 border-b pt-4 pb-1">6.3. Consumo de Alcohol</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                        <div>
                            <label for="alcohol_freq" class="block text-sm font-medium text-gray-700">Frecuencia de consumo</label>
                            <select id="alcohol_freq" class="mt-1 block w-full">
                                <option value="none">Nunca o casi nunca</option>
                                <option value="monthly">1-3 veces al mes</option>
                                <option value="weekly">1-2 veces por semana</option>
                                <option value="daily">Casi diario</option>
                            </select>
                        </div>
                        <div>
                            <label for="alcohol_dose" class="block text-sm font-medium text-gray-700">Dosis (Bebidas estÃ¡ndar/dÃ­a)</label>
                            <input type="number" id="alcohol_dose" placeholder="2" class="mt-1 block w-full">
                        </div>
                        <div>
                            <label for="alcohol_type" class="block text-sm font-medium text-gray-700">Tipo de alcohol principal</label>
                            <select id="alcohol_type" class="mt-1 block w-full">
                                <option value="beer">Cerveza</option>
                                <option value="wine">Vino</option>
                                <option value="spirit">Destilados (Tequila, Ron, etc.)</option>
                                <option value="mixed">Combinado</option>
                            </select>
                        </div>
                    </div>
                </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 7: DiagnÃ³sticos y Tratamiento -->
                <div class="bg-gray-50 p-6 rounded-xl shadow-lg space-y-6">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-notes-medical mr-3 ipn-accent"></i> 7. DiagnÃ³sticos y Tratamiento</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="p-4 rounded-lg border bg-white/70">
                            <label class="block text-base font-bold text-gray-800">Diabetes Mellitus (DM)</label>
                            <div class="mt-3 space-y-2 text-sm">
                                <div>
                                    <input type="radio" id="dm_no" name="dm_status" value="no" checked> <label for="dm_no">No diagnosticado</label>
                                </div>
                                <div>
                                    <input type="radio" id="dm_yes" name="dm_status" value="yes"> <label for="dm_yes">SÃ­ diagnosticado</label>
                                </div>
                                <label for="med_dm" class="block text-sm font-medium text-gray-700 pt-2">Â¿Toma medicaciÃ³n?</label>
                                <select id="med_dm" class="mt-1 block w-full">
                                    <option value="no">No</option>
                                    <option value="yes_freq">SÃ­, frecuentemente</option>
                                    <option value="yes_rare">SÃ­, ocasionalmente</option>
                                </select>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg border bg-white/70">
                            <label class="block text-base font-bold text-gray-800">HipertensiÃ³n (HTA)</label>
                            <div class="mt-3 space-y-2 text-sm">
                                <div>
                                    <input type="radio" id="hta_no" name="hta_status" value="no" checked> <label for="hta_no">No diagnosticado</label>
                                </div>
                                <div>
                                    <input type="radio" id="hta_yes" name="hta_status" value="yes"> <label for="hta_yes">SÃ­ diagnosticado</label>
                                </div>
                                <label for="med_hta" class="block text-sm font-medium text-gray-700 pt-2">Â¿Toma medicaciÃ³n?</label>
                                <select id="med_hta" class="mt-1 block w-full">
                                    <option value="no">No</option>
                                    <option value="yes_freq">SÃ­, frecuentemente</option>
                                    <option value="yes_rare">SÃ­, ocasionalmente</option>
                                </select>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg border bg-white/70">
                            <label class="block text-base font-bold text-gray-800">Dislipidemia</label>
                            <div class="mt-3 space-y-2 text-sm">
                                <div>
                                    <input type="radio" id="dlp_no" name="dlp_status" value="no" checked> <label for="dlp_no">No diagnosticado</label>
                                </div>
                                <div>
                                    <input type="radio" id="dlp_yes" name="dlp_status" value="yes"> <label for="dlp_yes">SÃ­ diagnosticado</label>
                                </div>
                                <label for="med_dlp" class="block text-sm font-medium text-gray-700 pt-2">Â¿Toma Estatinas o Fibratos?</label>
                                <select id="med_dlp" class="mt-1 block w-full">
                                    <option value="no">No</option>
                                    <option value="yes_freq">SÃ­, frecuentemente</option>
                                    <option value="yes_rare">SÃ­, ocasionalmente</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <!-- SECCIÃ“N 8: Historial Cardiovascular -->
                <div class="bg-white p-6 rounded-xl shadow-lg space-y-6 border-l-4 ipn-border">
                    <h2 class="text-2xl font-bold text-gray-700 border-b-2 ipn-accent/50 pb-2 flex items-center"><i class="fas fa-history mr-3 ipn-accent"></i> 8. Historial Cardiovascular</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="history_mi" class="block text-sm font-medium text-gray-700">Â¿Ha sido diagnosticado con un Infarto?</label>
                            <select id="history_mi" class="mt-1 block w-full">
                                <option value="no">No</option>
                                <option value="yes">SÃ­</option>
                            </select>
                        </div>
                        <div>
                            <label for="history_angina" class="block text-sm font-medium text-gray-700">Â¿Ha sentido dolor opresivo en el pecho (Angina)?</label>
                            <select id="history_angina" class="mt-1 block w-full">
                                <option value="no">No</option>
                                <option value="yes">SÃ­</option>
                            </select>
                        </div>
                        <div>
                            <label for="family_history" class="block text-sm font-medium text-gray-700">Antecedentes Familiares (ECV o DM)</label>
                            <select id="family_history" class="mt-1 block w-full">
                                <option value="no">No</option>
                                <option value="yes">SÃ­</option>
                            </select>
                        </div>
                    </div>
                </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="sheet-status" class="text-center p-3 mt-4 rounded-lg text-sm hidden"></div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="calculate-button" class="w-full mt-6 py-3 px-6 border border-transparent rounded-lg shadow-lg text-xl font-extrabold text-white ipn-bg hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out transform hover:scale-[1.005]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Calcular Riesgo Cardiovascular Integral
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>

Â  Â  Â  Â  <div id="results-section" class="hidden mt-10">
Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold ipn-accent mb-6 border-b-4 ipn-border pb-3">4. Resultados y Plan de AcciÃ³n</h2>

Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 rounded-xl border-2 space-y-4 shadow-md bg-white">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold mb-3 ipn-accent border-b pb-2">Perfil de Riesgo</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="global-risk-result" class="text-center p-4 rounded-lg font-bold text-2xl mb-4 transition duration-300"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-gray-700 border-b border-gray-200 pb-1">MÃ©tricas AntropomÃ©tricas:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 mt-2 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Edad:</span> <span id="res-age"></span> aÃ±os</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">IMC:</span> <span id="res-bmi-val"></span> <span id="res-bmi-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Ãndice Cintura-Cadera (ICC):</span> <span id="res-icc-val"></span> <span id="res-icc-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-gray-700 border-b border-gray-200 pb-1 pt-3">MÃ©tricas BioquÃ­micas (Ãndices):</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 mt-2 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Ãndice TG/HDL:</span> <span id="res-tg-hdl-val"></span> <span id="res-tg-hdl-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Ãndice Col Total/HDL:</span> <span id="res-chol-hdl-val"></span> <span id="res-chol-hdl-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">MASLD (FLI Score):</span> <span id="res-fli-val"></span> <span id="res-fli-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-semibold text-gray-700 border-b border-gray-200 pb-1 pt-3">Estilo de Vida y Fuerza:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 mt-2 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Ãndice TabÃ¡quico (IPA):</span> <span id="res-ipa-val"></span> <span id="res-ipa-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Actividad FÃ­sica:</span> <span id="res-activity-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li><span class="font-medium">Fuerza de Agarre:</span> <span id="res-grip-class" class="font-bold"></span></li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 rounded-xl border-2 bg-gray-50 shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold mb-3 ipn-accent border-b pb-2">Factores Clave</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="risk-factors-list" class="space-y-2 text-sm text-gray-700 list-disc ml-5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 rounded-xl border-2 border-green-500 bg-green-50 shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-4 text-green-700">Plan de AcciÃ³n Personalizado</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="recommendations-list" class="space-y-3 text-gray-800 list-disc ml-5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-8 no-print">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="print-button" class="w-full py-2 px-4 border border-blue-600 rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-150 ease-in-out">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Imprimir Reporte (PDF)
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-8 text-center border-t pt-4">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 italic">**Nota Importante:** Esta herramienta es parte de un proyecto de tesis y no sustituye la evaluaciÃ³n mÃ©dica profesional. Consulte a su mÃ©dico para un diagnÃ³stico y tratamiento precisos.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="border-t pt-4 mt-8 no-print"></div>Â 
Â  Â  Â  Â  <div id="project-info" class="p-4 bg-gray-50 rounded-lg text-sm no-print shadow-inner">
Â  Â  Â  Â  Â  Â <h3 class="font-bold text-lg ipn-accent mb-4 border-b pb-1 flex items-center">
                <i class="fas fa-info-circle mr-3"></i> InformaciÃ³n del Proyecto y Colaboradores
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Columna 1: Presenta e InstituciÃ³n -->
                <div class="bg-white p-6 rounded-xl shadow-md space-y-3">
                    <h4 class="text-lg font-bold text-gray-800 border-b pb-2 flex items-center">
                        <i class="fas fa-graduation-cap mr-3 ipn-accent"></i> Presenta y AsesorÃ­a
                    </h4>
                    <p class="text-sm text-gray-700"><strong>Edsel Yahvi MÃ©ndez HernÃ¡ndez</strong></p>
                    <p class="text-sm text-gray-600">Asesora Externa: Dra. Nayelli NÃ¡jera GarcÃ­a</p>
                    <p class="text-sm text-gray-600">Asesor Interno (Docente): Dr. Bustos GarcÃ­a Juan Roberto Israel</p>
                    <p class="font-semibold text-gray-700 mt-3">InstituciÃ³n:</p>
                    <p class="text-sm text-gray-600">
                        <a href="https://www.esm.ipn.mx/" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                            Escuela Superior de Medicina (ESM) - IPN
                        </a>
                    </p>
                </div>

                <!-- Columna 2: Laboratorio -->
                <div class="bg-white p-6 rounded-xl shadow-md space-y-3">
                    <h4 class="text-lg font-bold text-gray-800 border-b pb-2 flex items-center">
                        <i class="fas fa-microscope mr-3 ipn-accent"></i> Laboratorio Colaborador (LICAM)
                    </h4>
                    <p class="text-gray-600 text-sm">InvestigaciÃ³n Integral CardiometabÃ³lica (IPN)</p>
                </div>

                <!-- Columna 3: Contacto y Redes -->
                <div class="bg-white p-6 rounded-xl shadow-md space-y-3">
                    <h4 class="text-lg font-bold text-gray-800 border-b pb-2 flex items-center">
                        <i class="fas fa-address-card mr-3 ipn-accent"></i> Contacto y Redes
                    </h4>
                    <div class="text-sm text-gray-600 space-y-2">
                        <p class="flex items-start">
                            <i class="fas fa-map-marker-alt w-4 mr-2 mt-1 ipn-accent/80"></i>
                            <span><span class="font-semibold">UbicaciÃ³n:</span> Plan de San Luis y DÃ­az MirÃ³n s/n Col. Casco de Santo TomÃ¡s, Miguel Hidalgo, 11340, CDMX.</span>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-envelope w-4 mr-2 ipn-accent/80"></i>
                            <span><span class="font-semibold">Correo:</span> nnajerag@ipn.mx</span>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-phone w-4 mr-2 ipn-accent/80"></i>
                            <span><span class="font-semibold">TelÃ©fono:</span> 55 5729 6300 ext 62820</span>
                        </p>
                        <div class="border-t pt-3 mt-3">
                            <p class="flex items-center space-x-4">
                                <i class="fas fa-globe w-4 mr-2 ipn-accent/80"></i>
                                <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                                    Sitio Web
                                </a>
                                <a href="https://www.facebook.com/licam.ipn" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                                    Facebook
                                </a>
                                <a href="https://www.instagram.com/ipn_licam_lab" target="_blank" class="text-pink-600 hover:text-pink-800 font-semibold underline">
                                    Instagram
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
Â  Â  Â  Â  Â </div>
Â  Â  </div>

Â  Â  <button type="button" id="reset-button" class="mt-4 py-2 px-4 border ipn-border rounded-lg shadow-sm text-sm font-medium ipn-accent bg-white hover:bg-red-50 transition duration-150 ease-in-out fixed top-8 right-8 hidden no-print">
Â  Â  Â  Â  &larr; Calcular Nuevo
Â  Â  </button>


Â  Â  <script>
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â  // === CALCULADORA DE RIESGO INTEGRAL V2 - LOGIC.JS ====
Â  Â  Â  Â  // =======================================================
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- CONFIGURACIÃ“N DE INTEGRACIÃ“N CON GOOGLE SHEETS (IMPORTANTE) ---
Â  Â  Â  Â  // Â¡ACTUALIZADO CON TU ÃšLTIMA URL DE DESPLIEGUE!
Â  Â  Â  Â  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbweuEciVBAMuQgFMJe6HQrH4Q3v4aAKyhlZUr45lAIiZCseb095Hy8ljd2NDOvv42ODIw/exec";
Â  Â  Â  Â  // --------------------------------------------------------------------
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- CONSTANTES GLOBALES Y PUNTOS DE CORTE (Basados en IMSS y GuÃ­as) ---
Â  Â  Â  Â  const CONSTANTS = {
Â  Â  Â  Â  Â  Â  // IMSS (1000167606.jpg)
Â  Â  Â  Â  Â  Â  IMC: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 25,
Â  Â  Â  Â  Â  Â  Â  Â  SOBREPESO: 30,
Â  Â  Â  Â  Â  Â  Â  Â  OBESIDAD_I: 35
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  GLUCOSA: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 100,
Â  Â  Â  Â  Â  Â  Â  Â  PREDIABETES: 126
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  HBA1C: { // AÃ±adido desde guÃ­as estÃ¡ndar
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 5.7,
Â  Â  Â  Â  Â  Â  Â  Â  PREDIABETES: 6.5
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  TRIGLICERIDOS: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 150,
Â  Â  Â  Â  Â  Â  Â  Â  LIMITE: 200
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  COLESTEROL_TOTAL: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 200,
Â  Â  Â  Â  Â  Â  Â  Â  LIMITE: 240
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  HDL_HOMBRES: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 40 // Riesgo si < 40
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  HDL_MUJERES: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 50 // Riesgo si < 50
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  LDL: { // AÃ±adido desde guÃ­as estÃ¡ndar
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 100,
Â  Â  Â  Â  Â  Â  Â  Â  LIMITE: 130,
Â  Â  Â  Â  Â  Â  Â  Â  ALTO: 160
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  CINTURA_HOMBRES: {
Â  Â  Â  Â  Â  Â  Â  Â  NORMAL: 90 // Riesgo si >= 90
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  CINTURA_MUJERES: {
Â  Â  Â  Â  Â  Â  Â  Â  RIESGO_ALTO: 0.85 // > 0.85 es Riesgo Alto en mujeres
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  INDICE_TG_HDL: { // TriglicÃ©ridos / HDL
Â  Â  Â  Â  Â  Â  Â  Â  ALTO_RIESGO: 3.5 // > 3.5 sugiere alta Resistencia a Insulina
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  INDICE_COL_HDL: { // Colesterol Total / HDL
Â  Â  Â  Â  Â  Â  Â  Â  ALTO_RIESGO: 5.0 // > 5.0 es Alto Riesgo
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  IPA: { // Ãndice Paquete-AÃ±o
Â  Â  Â  Â  Â  Â  Â  Â  RIESGO_LEVE: 10
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  FLI_MASLD: { // Fatty Liver Index
Â  Â  Â  Â  Â  Â  Â  Â  BAJO: 30,
Â  Â  Â  Â  Â  Â  Â  Â  ALTO: 60
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- TABLA DE DINAMOMETRÃA (1000167605.jpg) ---
Â  Â  Â  Â  const DYNAMOMETRY_P10 = {
Â  Â  Â  Â  Â  Â  hombres: {
Â  Â  Â  Â  Â  Â  Â  Â  "20-29": 33.9,Â 
Â  Â  Â  Â  Â  Â  Â  Â  "30-39": 36.6,
Â  Â  Â  Â  Â  Â  Â  Â  "40-49": 34.3,
Â  Â  Â  Â  Â  Â  Â  Â  "50-59": 30.2,
Â  Â  Â  Â  Â  Â  Â  Â  "60-69": 26.5,
Â  Â  Â  Â  Â  Â  Â  Â  "70-99": 22.8,Â 
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  mujeres: {
Â  Â  Â  Â  Â  Â  Â  Â  "20-29": 19.5,
Â  Â  Â  Â  Â  Â  Â  Â  "30-39": 20.7,
Â  Â  Â  Â  Â  Â  Â  Â  "40-49": 19.8,
Â  Â  Â  Â  Â  Â  Â  Â  "50-59": 16.6,
Â  Â  Â  Â  Â  Â  Â  Â  "60-69": 19.6,Â 
Â  Â  Â  Â  Â  Â  Â  Â  "70-99": 13.0,Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * FunciÃ³n Principal: Se ejecuta cuando se presiona el botÃ³n "Calcular"
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function calculateRisk_v2() {
Â  Â  Â  Â  Â  Â  const validationDiv = document.getElementById('validation-message');
Â  Â  Â  Â  Â  Â  validationDiv.classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('sheet-status').classList.add('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  console.log("Iniciando cÃ¡lculo y envÃ­o de datos v2...");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. RecolecciÃ³n y CÃ¡lculos de Edad
Â  Â  Â  Â  Â  Â  const inputs = getUserInputs_v2();
Â  Â  Â  Â  Â  Â  if (!inputs) {
Â  Â  Â  Â  Â  Â  Â  Â  validationDiv.textContent = "âš ï¸ Por favor, complete todos los campos obligatorios (SecciÃ³n 1-4) con valores numÃ©ricos vÃ¡lidos (ej: edad, peso, estatura, glucosa, PAS/PAD).";
Â  Â  Â  Â  Â  Â  Â  Â  validationDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. CÃ¡lculos de MÃ©tricas AutomÃ¡ticas (IMC, ICC, Ãndices, etc.)
Â  Â  Â  Â  Â  Â  const metrics = calculateMetrics(inputs);

Â  Â  Â  Â  Â  Â  // 3. Chequeo de Comorbilidades (LÃ³gica de DiagnÃ³stico vs Medicamento)
Â  Â  Â  Â  Â  Â  const healthStatus = checkComorbidities(inputs);

Â  Â  Â  Â  Â  Â  // 4. CÃ¡lculo del Score de Riesgo HeurÃ­stico (El "Cerebro")
Â  Â  Â  Â  Â  Â  const riskProfile = calculateHeuristicScore_v2(inputs, metrics, healthStatus);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 5. EnvÃ­o de Datos a Google Sheets (AsÃ­ncrono)
Â  Â  Â  Â  Â  Â  await sendDataToSheets(inputs, metrics, riskProfile);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 6. GeneraciÃ³n de Resultados en la UI
Â  Â  Â  Â  Â  Â  generateResults_v2(inputs, metrics, riskProfile);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 7. Guardar resultados en variable global para 'copiar'
Â  Â  Â  Â  Â  Â  window.lastResultData_v2 = { inputs, metrics, riskProfile };

Â  Â  Â  Â  Â  Â  // 8. Ocultar formulario y mostrar resultados
Â  Â  Â  Â  Â  Â  document.getElementById('input-form').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('results-section').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reset-button').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);

Â  Â  Â  Â  Â  Â  console.log("CÃ¡lculo finalizado. Perfil de Riesgo:", riskProfile);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 5.1: EnvÃ­a los datos de entrada y resultados calculados a Google Sheets.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function sendDataToSheets(inputs, metrics, riskProfile) {
Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('sheet-status');
Â  Â  Â  Â  Â  Â  statusDiv.textContent = "Enviando datos a la base de datos (Google Sheets)...";
Â  Â  Â  Â  Â  Â  statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-blue-100 text-blue-800";
Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Consolidar todos los datos relevantes en un solo objeto para el POST
Â  Â  Â  Â  Â  Â  const dataToSend = {
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toLocaleString('es-MX', { timeZone: 'America/Mexico_City' }),
Â  Â  Â  Â  Â  Â  Â  Â  fullName: inputs.full_name || 'Sin nombre',
Â  Â  Â  Â  Â  Â  Â  Â  email: inputs.email || '',
Â  Â  Â  Â  Â  Â  Â  Â  gender: inputs.gender === 'male' ? 'Masculino' : 'Femenino',
Â  Â  Â  Â  Â  Â  Â  Â  age: inputs.age,
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Signos y AntropometrÃ­a
Â  Â  Â  Â  Â  Â  Â  Â  paSistolica: inputs.pa_used.s,
Â  Â  Â  Â  Â  Â  Â  Â  paDiastolica: inputs.pa_used.d,
Â  Â  Â  Â  Â  Â  Â  Â  paSource: inputs.pa_used.source,
Â  Â  Â  Â  Â  Â  Â  Â  hr: inputs.hr,
Â  Â  Â  Â  Â  Â  Â  Â  rr: inputs.rr,
Â  Â  Â  Â  Â  Â  Â  Â  weight: inputs.weight,
Â  Â  Â  Â  Â  Â  Â  Â  height_cm: inputs.height_cm,
Â  Â  Â  Â  Â  Â  Â  Â  waist: inputs.waist,
Â  Â  Â  Â  Â  Â  Â  Â  hip: inputs.hip,
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // MÃ©tricas calculadas
Â  Â  Â  Â  Â  Â  Â  Â  bmi: metrics.bmi,
Â  Â  Â  Â  Â  Â  Â  Â  bmiClass: metrics.bmi_class,
Â  Â  Â  Â  Â  Â  Â  Â  icc: metrics.icc,
Â  Â  Â  Â  Â  Â  Â  Â  iccClass: metrics.icc_class,
Â  Â  Â  Â  Â  Â  Â  Â  fliScore: metrics.fli_score,
Â  Â  Â  Â  Â  Â  Â  Â  fliClass: metrics.fli_class,
Â  Â  Â  Â  Â  Â  Â  Â  gripFactorText: riskProfile.grip_factor_text,

Â  Â  Â  Â  Â  Â  Â  Â  // BioquÃ­micos
Â  Â  Â  Â  Â  Â  Â  Â  glucose: inputs.glucose,
Â  Â  Â  Â  Â  Â  Â  Â  hba1c: inputs.hba1c,
Â  Â  Â  Â  Â  Â  Â  Â  totalChol: inputs.total_chol,
Â  Â  Â  Â  Â  Â  Â  Â  hdl: inputs.hdl,
Â  Â  Â  Â  Â  Â  Â  Â  ldl: inputs.ldl,
Â  Â  Â  Â  Â  Â  Â  Â  triglycerides: inputs.triglycerides,
Â  Â  Â  Â  Â  Â  Â  Â  tgHdlIndex: metrics.tg_hdl,
Â  Â  Â  Â  Â  Â  Â  Â  cholHdlIndex: metrics.chol_hdl,

Â  Â  Â  Â  Â  Â  Â  Â  // Estilo de Vida
Â  Â  Â  Â  Â  Â  Â  Â  activity: `${inputs.activity_days} dÃ­as/${inputs.activity_duration} min (${inputs.activity_intensity})`,
Â  Â  Â  Â  Â  Â  Â  Â  smokerStatus: inputs.smoker_status,
Â  Â  Â  Â  Â  Â  Â  Â  ipaScore: metrics.ipa,
Â  Â  Â  Â  Â  Â  Â  Â  alcoholFreq: inputs.alcohol_freq,

Â  Â  Â  Â  Â  Â  Â  Â  // Comorbilidades
Â  Â  Â  Â  Â  Â  Â  Â  dmStatus: inputs.dm_status,
Â  Â  Â  Â  Â  Â  Â  Â  medDm: inputs.med_dm,
Â  Â  Â  Â  Â  Â  Â  Â  htaStatus: inputs.hta_status,
Â  Â  Â  Â  Â  Â  Â  Â  medHta: inputs.med_hta,
Â  Â  Â  Â  Â  Â  Â  Â  dlpStatus: inputs.dlp_status,
Â  Â  Â  Â  Â  Â  Â  Â  medDlp: inputs.med_dlp,
Â  Â  Â  Â  Â  Â  Â  Â  historyMI: inputs.history_mi,
Â  Â  Â  Â  Â  Â  Â  Â  familyHistory: inputs.family_history,
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Resultados de Riesgo
Â  Â  Â  Â  Â  Â  Â  Â  riskScore: riskProfile.score,
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel: riskProfile.level,
Â  Â  Â  Â  Â  Â  Â  Â  riskFactorsList: riskProfile.factors.map(f => f.text).join(' | '),
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Usamos fetch con 'no-cors' para Apps Script POST
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(WEB_APP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mode: 'no-cors',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cache: 'no-cache',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(dataToSend)
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Asumimos Ã©xito debido a 'no-cors'.
Â  Â  Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('sheet-status');
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = "âœ… Datos guardados en Sheets con Ã©xito.";
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-green-100 text-green-800";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al enviar datos a Google Sheets. La aplicaciÃ³n local sigue funcionando.", error);
Â  Â  Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('sheet-status');
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = "âŒ Error al guardar datos en Sheets. Revise la consola. El cÃ¡lculo local se completÃ³.";
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-red-100 text-red-800";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 1: Recolecta todos los datos del formulario HTML.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function getUserInputs_v2() {
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const getVal = (id) => document.getElementById(id)?.value || null;
Â  Â  Â  Â  Â  Â  const getNum = (id) => parseFloat(document.getElementById(id)?.value) || null;
Â  Â  Â  Â  Â  Â  const getRad = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value || "no";

Â  Â  Â  Â  Â  Â  // --- Helper: Calcular Edad ---
Â  Â  Â  Â  Â  Â  const getAge = (birthDateString) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!birthDateString) return null;
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  const birthDate = new Date(birthDateString);
Â  Â  Â  Â  Â  Â  Â  Â  let age = today.getFullYear() - birthDate.getFullYear();
Â  Â  Â  Â  Â  Â  Â  Â  const m = today.getMonth() - birthDate.getMonth();
Â  Â  Â  Â  Â  Â  Â  Â  if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  age--;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return age;
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const inputs = {
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 1
Â  Â  Â  Â  Â  Â  Â  Â  full_name: getVal('full_name'),
Â  Â  Â  Â  Â  Â  Â  Â  birth_date: getVal('birth_date'),
Â  Â  Â  Â  Â  Â  Â  Â  age: getAge(getVal('birth_date')),
Â  Â  Â  Â  Â  Â  Â  Â  gender: getVal('gender'),
Â  Â  Â  Â  Â  Â  Â  Â  email: getVal('email'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 2
Â  Â  Â  Â  Â  Â  Â  Â  hr: getNum('hr'),
Â  Â  Â  Â  Â  Â  Â  Â  rr: getNum('rr'),
Â  Â  Â  Â  Â  Â  Â  Â  grip_right: getNum('grip_right'),
Â  Â  Â  Â  Â  Â  Â  Â  grip_left: getNum('grip_left'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 2.1 - Promedio de PA
Â  Â  Â  Â  Â  Â  Â  Â  pa_used: getAverageBP(getNum('pas'), getNum('pad')),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 3
Â  Â  Â  Â  Â  Â  Â  Â  height_cm: getNum('height'),
Â  Â  Â  Â  Â  Â  Â  Â  weight: getNum('weight'),
Â  Â  Â  Â  Â  Â  Â  Â  waist: getNum('waist'),
Â  Â  Â  Â  Â  Â  Â  Â  hip: getNum('hip'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 4
Â  Â  Â  Â  Â  Â  Â  Â  glucose: getNum('glucose'),
Â  Â  Â  Â  Â  Â  Â  Â  hba1c: getNum('hba1c'),
Â  Â  Â  Â  Â  Â  Â  Â  total_chol: getNum('total_chol'),
Â  Â  Â  Â  Â  Â  Â  Â  hdl: getNum('hdl'),
Â  Â  Â  Â  Â  Â  Â  Â  ldl: getNum('ldl'),
Â  Â  Â  Â  Â  Â  Â  Â  triglycerides: getNum('triglycerides'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 5 (BIA) - No se usan para el cÃ¡lculo principal, solo para logging si se completan
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 6.1 (Actividad)
Â  Â  Â  Â  Â  Â  Â  Â  activity_days: getNum('activity_days'),
Â  Â  Â  Â  Â  Â  Â  Â  activity_duration: getNum('activity_duration'),
Â  Â  Â  Â  Â  Â  Â  Â  activity_intensity: getVal('activity_intensity'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 6.2 (Tabaquismo)
Â  Â  Â  Â  Â  Â  Â  Â  smoker_status: getVal('smoker_status'),
Â  Â  Â  Â  Â  Â  Â  Â  smoker_passive: getVal('smoker_passive'),
Â  Â  Â  Â  Â  Â  Â  Â  smoker_years: getNum('smoker_years'),
Â  Â  Â  Â  Â  Â  Â  Â  smoker_daily_avg: getNum('smoker_daily_avg'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 6.3 (Alcohol)
Â  Â  Â  Â  Â  Â  Â  Â  alcohol_freq: getVal('alcohol_freq'),
Â  Â  Â  Â  Â  Â  Â  Â  alcohol_dose: getNum('alcohol_dose'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 7 (Comorbilidades)
Â  Â  Â  Â  Â  Â  Â  Â  dm_status: getRad('dm_status'),
Â  Â  Â  Â  Â  Â  Â  Â  med_dm: getVal('med_dm'),
Â  Â  Â  Â  Â  Â  Â  Â  hta_status: getRad('hta_status'),
Â  Â  Â  Â  Â  Â  Â  Â  med_hta: getVal('med_hta'),
Â  Â  Â  Â  Â  Â  Â  Â  dlp_status: getRad('dlp_status'),
Â  Â  Â  Â  Â  Â  Â  Â  med_dlp: getVal('med_dlp'),
Â  Â  Â  Â  Â  Â  Â  Â  // SecciÃ³n 8 (Historial)
Â  Â  Â  Â  Â  Â  Â  Â  history_mi: getVal('history_mi'),
Â  Â  Â  Â  Â  Â  Â  Â  history_angina: getVal('history_angina'),
Â  Â  Â  Â  Â  Â  Â  Â  family_history: getVal('family_history')
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // ValidaciÃ³n bÃ¡sica (Campos obligatorios - Secciones 1 a 4)
Â  Â  Â  Â  Â  Â  if (!inputs.age || inputs.age < 0 || !inputs.height_cm || !inputs.weight || !inputs.waist || !inputs.hip || !inputs.glucose || !inputs.total_chol || !inputs.hdl || !inputs.triglycerides || !inputs.pa_used) {
Â  Â  Â  Â  Â  Â  Â  Â  return null; // Faltan datos clave
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return inputs;
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Helper para PASO 1: Calcula el promedio de PA si existe.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function getAverageBP(pas, pad) {
Â  Â  Â  Â  Â  Â  const bp_readings = [];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Lectura principal (obligatoria)
Â  Â  Â  Â  Â  Â  if (pas && pad) {
Â  Â  Â  Â  Â  Â  Â  Â  bp_readings.push({ s: pas, d: pad });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  return null; // Si no hay lectura principal, no se puede calcular
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Lecturas opcionales
Â  Â  Â  Â  Â  Â  const s2 = parseFloat(document.getElementById('pa_d2_s').value);
Â  Â  Â  Â  Â  Â  const d2 = parseFloat(document.getElementById('pa_d2_d').value);
Â  Â  Â  Â  Â  Â  if (!isNaN(s2) && !isNaN(d2) && s2 > 0 && d2 > 0) bp_readings.push({ s: s2, d: d2 });

Â  Â  Â  Â  Â  Â  const s3 = parseFloat(document.getElementById('pa_d3_s').value);
Â  Â  Â  Â  Â  Â  const d3 = parseFloat(document.getElementById('pa_d3_d').value);
Â  Â  Â  Â  Â  Â  if (!isNaN(s3) && !isNaN(d3) && s3 > 0 && d3 > 0) bp_readings.push({ s: s3, d: d3 });

Â  Â  Â  Â  Â  Â  const total_s = bp_readings.reduce((sum, reading) => sum + reading.s, 0);
Â  Â  Â  Â  Â  Â  const total_d = bp_readings.reduce((sum, reading) => sum + reading.d, 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  s: Math.round(total_s / bp_readings.length),
Â  Â  Â  Â  Â  Â  Â  Â  d: Math.round(total_d / bp_readings.length),
Â  Â  Â  Â  Â  Â  Â  Â  source: bp_readings.length > 1 ? `Promedio de ${bp_readings.length} tomas` : "Toma Ãºnica"
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 2: Calcula mÃ©tricas automÃ¡ticas (IMC, ICC, Ãndices, FLI, IPA).
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function calculateMetrics(inputs) {
Â  Â  Â  Â  Â  Â  const metrics = {};
Â  Â  Â  Â  Â  Â  const { weight, height_cm, waist, hip, triglycerides, hdl, total_chol, smoker_status, smoker_daily_avg, smoker_years } = inputs;

Â  Â  Â  Â  Â  Â  // 1. IMC (Ãndice de Masa Corporal)
Â  Â  Â  Â  Â  Â  const height_m = height_cm / 100;
Â  Â  Â  Â  Â  Â  metrics.bmi = parseFloat((weight / (height_m * height_m)).toFixed(1));
Â  Â  Â  Â  Â  Â  metrics.bmi_class = getBmiClass(metrics.bmi);

Â  Â  Â  Â  Â  Â  // 2. ICC (Ãndice Cintura-Cadera)
Â  Â  Â  Â  Â  Â  metrics.icc = parseFloat((waist / hip).toFixed(2));
Â  Â  Â  Â  Â  Â  metrics.icc_class = getIccClass(metrics.icc, inputs.gender);

Â  Â  Â  Â  Â  Â  // 3. Ãndice TG/HDL
Â  Â  Â  Â  Â  Â  metrics.tg_hdl = parseFloat((triglycerides / hdl).toFixed(2));
Â  Â  Â  Â  Â  Â  metrics.tg_hdl_class = metrics.tg_hdl >= CONSTANTS.INDICE_TG_HDL.ALTO_RIESGO ? "Alto Riesgo" : "Normal";

Â  Â  Â  Â  Â  Â  // 4. Ãndice Col Total/HDL
Â  Â  Â  Â  Â  Â  metrics.chol_hdl = parseFloat((total_chol / hdl).toFixed(2));
Â  Â  Â  Â  Â  Â  metrics.chol_hdl_class = metrics.chol_hdl >= CONSTANTS.INDICE_COL_HDL.ALTO_RIESGO ? "Alto Riesgo" : "Normal";

Â  Â  Â  Â  Â  Â  // 5. IPA (Ãndice Paquete-AÃ±o)
Â  Â  Â  Â  Â  Â  if (smoker_status === 'active' && smoker_daily_avg > 0 && smoker_years > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  metrics.ipa = parseFloat(((smoker_daily_avg / 20) * smoker_years).toFixed(1));
Â  Â  Â  Â  Â  Â  Â  Â  metrics.ipa_class = metrics.ipa >= CONSTANTS.IPA.RIESGO_LEVE ? "Riesgo Elevado" : "Riesgo Bajo";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  metrics.ipa = 0;
Â  Â  Â  Â  Â  Â  Â  Â  metrics.ipa_class = "No aplica";
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 6. FLI (Fatty Liver Index)
Â  Â  Â  Â  Â  Â  const ln_tg = Math.log(triglycerides);
Â  Â  Â  Â  Â  Â  const ln_waist = Math.log(waist);
Â  Â  Â  Â  Â  Â  const X = (0.953 * ln_tg) + (0.139 * metrics.bmi) + (0.718 * ln_waist) - 13.9;
Â  Â  Â  Â  Â  Â  metrics.fli_score = parseFloat(((Math.exp(X) / (1 + Math.exp(X))) * 100).toFixed(1));
Â  Â  Â  Â  Â  Â  metrics.fli_class = metrics.fli_score >= CONSTANTS.FLI_MASLD.ALTO ? "Alto Riesgo" : (metrics.fli_score >= CONSTANTS.FLI_MASLD.BAJO ? "Riesgo Moderado" : "Bajo Riesgo");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return metrics;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Helpers para Paso 2
Â  Â  Â  Â  function getBmiClass(bmi) {
Â  Â  Â  Â  Â  Â  if (bmi < 18.5) return "Bajo Peso";
Â  Â  Â  Â  Â  Â  if (bmi < CONSTANTS.IMC.NORMAL) return "Normal";
Â  Â  Â  Â  Â  Â  if (bmi < CONSTANTS.IMC.SOBREPESO) return "Sobrepeso";
Â  Â  Â  Â  Â  Â  if (bmi < CONSTANTS.IMC.OBESIDAD_I) return "Obesidad Grado I";
Â  Â  Â  Â  Â  Â  return "Obesidad Grado II+";
Â  Â  Â  Â  }
Â  Â  Â  Â  function getIccClass(icc, gender) {
Â  Â  Â  Â  Â  Â  const cutoff = gender === 'male' ? CONSTANTS.ICC_HOMBRES.RIESGO_ALTO : CONSTANTS.ICC_MUJERES.RIESGO_ALTO;
Â  Â  Â  Â  Â  Â  return icc >= cutoff ? "Riesgo Cardiovascular Alto" : "Riesgo Normal";
Â  Â  Â  Â  }


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 3: Verifica comorbilidades (LÃ³gica de DiagnÃ³stico vs Medicamento).
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function checkComorbidities(inputs) {
Â  Â  Â  Â  Â  Â  const status = {
Â  Â  Â  Â  Â  Â  Â  Â  dm: "no",
Â  Â  Â  Â  Â  Â  Â  Â  hta: "no",
Â  Â  Â  Â  Â  Â  Â  Â  dlp: "no"
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Diabetes
Â  Â  Â  Â  Â  Â  if (inputs.dm_status === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  status.dm = "diagnosticada";
Â  Â  Â  Â  Â  Â  } else if (inputs.med_dm === 'yes_freq') {
Â  Â  Â  Â  Â  Â  Â  Â  status.dm = "tratada_no_dx"; // LÃ³gica solicitada
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // HipertensiÃ³n
Â  Â  Â  Â  Â  Â  if (inputs.hta_status === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  status.hta = "diagnosticada";
Â  Â  Â  Â  Â  Â  } else if (inputs.med_hta === 'yes_freq') {
Â  Â  Â  Â  Â  Â  Â  Â  status.hta = "tratada_no_dx"; // LÃ³gica solicitada
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Dislipidemia
Â  Â  Â  Â  Â  Â  if (inputs.dlp_status === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  status.dlp = "diagnosticada";
Â  Â  Â  Â  Â  Â  } else if (inputs.med_dlp === 'yes_freq') {
Â  Â  Â  Â  Â  Â  Â  Â  status.dlp = "tratada_no_dx"; // LÃ³gica solicitada
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return status;
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 4: Calcula el Score de Riesgo HeurÃ­stico (El "Cerebro").
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function calculateHeuristicScore_v2(inputs, metrics, healthStatus) {
Â  Â  Â  Â  Â  Â  let score = 0;
Â  Â  Â  Â  Â  Â  const riskFactors = []; // Lista de texto de factores de riesgo
Â  Â  Â  Â  Â  Â  let gripFactor = { text: "Fuerza de Agarre No Medida", class: "risk-moderate" }; // Default

Â  Â  Â  Â  Â  Â  // A. Edad y Sexo (Base Risk)
Â  Â  Â  Â  Â  Â  if (inputs.age >= 45 && inputs.gender === 'male') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  } else if (inputs.age >= 55 && inputs.gender === 'female') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // B. Historial Cardiovascular (MÃ¡xima PonderaciÃ³n)
Â  Â  Â  Â  Â  Â  if (inputs.history_mi === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 50; // Evento previo es el predictor mÃ¡s fuerte
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Infarto Previo Diagnosticado", class: "risk-very-high" });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (inputs.history_angina === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 30; // SÃ­ntomas de angina
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "SÃ­ntomas de Angina de Pecho", class: "risk-high" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // C. Comorbilidades (Usando la lÃ³gica del Paso 3)
Â  Â  Â  Â  Â  Â  if (healthStatus.dm === 'diagnosticada') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 30;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Diabetes Mellitus Diagnosticada", class: "risk-high" });
Â  Â  Â  Â  Â  Â  } else if (healthStatus.dm === 'tratada_no_dx' || (inputs.hba1c && inputs.hba1c >= CONSTANTS.HBA1C.PREDIABETES) || inputs.glucose >= CONSTANTS.GLUCOSA.PREDIABETES) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 20;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Estado de Prediabetes o DM no controlada", class: "risk-high" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (healthStatus.hta === 'diagnosticada') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 25;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "HipertensiÃ³n Diagnosticada", class: "risk-high" });
Â  Â  Â  Â  Â  Â  } else if (healthStatus.hta === 'tratada_no_dx' || inputs.pa_used.s >= 140 || inputs.pa_used.d >= 90) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 20;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `PresiÃ³n Arterial Elevada (${inputs.pa_used.s}/${inputs.pa_used.d} mmHg)`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  } else if (inputs.pa_used.s >= 130 || inputs.pa_used.d >= 85) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `PresiÃ³n Arterial LÃ­mite (${inputs.pa_used.s}/${inputs.pa_used.d} mmHg)`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // D. ParÃ¡metros BioquÃ­micos (Dislipidemia)
Â  Â  Â  Â  Â  Â  if (inputs.ldl) { // Solo si se proveyÃ³ LDL
Â  Â  Â  Â  Â  Â  Â  Â  Â if (inputs.ldl >= CONSTANTS.LDL.ALTO) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â score += 20;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â riskFactors.push({ text: `Colesterol LDL Muy Alto (>${CONSTANTS.LDL.ALTO})`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (inputs.ldl >= CONSTANTS.LDL.LIMITE) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â riskFactors.push({ text: `Colesterol LDL LÃ­mite (>${CONSTANTS.LDL.LIMITE})`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (metrics.tg_hdl >= CONSTANTS.INDICE_TG_HDL.ALTO_RIESGO) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 15;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Ãndice TG/HDL Elevado (>${CONSTANTS.INDICE_TG_HDL.ALTO_RIESGO})`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  } else if (inputs.triglycerides >= CONSTANTS.TRIGLICERIDOS.LIMITE) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 5;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `TriglicÃ©ridos LÃ­mite (>${CONSTANTS.TRIGLICERIDOS.LIMITE})`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (metrics.chol_hdl >= CONSTANTS.INDICE_COL_HDL.ALTO_RIESGO) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Ãndice Col/HDL Elevado (>${CONSTANTS.INDICE_COL_HDL.ALTO_RIESGO})`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // E. AntropometrÃ­a
Â  Â  Â  Â  Â  Â  // LÃ“GICA < 18 AÃ‘OS: Solo se suma si es mayor de edad.
Â  Â  Â  Â  Â  Â  if (inputs.age >= 18) {
Â  Â  Â  Â  Â  Â  Â  Â  if (metrics.bmi >= CONSTANTS.IMC.OBESIDAD_I) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score += 20;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Obesidad General (IMC >${CONSTANTS.IMC.OBESIDAD_I})`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  Â  Â  } else if (metrics.bmi >= CONSTANTS.IMC.SOBREPESO) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Sobrepeso (IMC >${CONSTANTS.IMC.NORMAL})`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â riskFactors.push({ text: `IMC (${metrics.bmi}) no usado para score (menor de 18)`, class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // ICC (Obesidad Abdominal)
Â  Â  Â  Â  Â  Â  if (metrics.icc_class === "Riesgo Cardiovascular Alto") {
Â  Â  Â  Â  Â  Â  Â  Â  score += 15;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Obesidad Abdominal (ICC Alto: ${metrics.icc})`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // F. DinamometrÃ­a (Sarcopenia/Fragilidad)
Â  Â  Â  Â  Â  Â  const [newScore, dynFactor] = checkDynamometry(inputs, score);
Â  Â  Â  Â  Â  Â  if (dynFactor) {
Â  Â  Â  Â  Â  Â  Â  Â  score = newScore;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push(dynFactor);
Â  Â  Â  Â  Â  Â  Â  Â  gripFactor = dynFactor; // Para mostrar en el resumen
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // G. Estilo de Vida
Â  Â  Â  Â  Â  Â  if (metrics.ipa >= CONSTANTS.IPA.RIESGO_LEVE) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 20;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Tabaquismo Activo (IPA: ${metrics.ipa})`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  } else if (inputs.smoker_passive === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 5;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Fumador Pasivo", class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Actividad FÃ­sica (Meta 150 min/sem moderada)
Â  Â  Â  Â  Â  Â  const totalActivity = (inputs.activity_days * inputs.activity_duration) || 0;
Â  Â  Â  Â  Â  Â  if (totalActivity < 150 && inputs.activity_intensity !== 'vigorous') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Sedentarismo (No cumple 150 min/sem)", class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Alcohol
Â  Â  Â  Â  Â  Â  if (inputs.alcohol_freq === 'daily' && inputs.alcohol_dose >= 2) {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Consumo de Alcohol de Riesgo", class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // H. Historial Familiar
Â  Â  Â  Â  Â  Â  if (inputs.family_history === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10;
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: "Antecedentes Familiares Positivos", class: "risk-moderate" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // I. Riesgo HepÃ¡tico (MASLD)
Â  Â  Â  Â  Â  Â  if (metrics.fli_class === "Alto Riesgo") {
Â  Â  Â  Â  Â  Â  Â  Â  score += 10; // El riesgo hepÃ¡tico aumenta el riesgo CV
Â  Â  Â  Â  Â  Â  Â  Â  riskFactors.push({ text: `Alto Riesgo de MASLD (HÃ­gado Graso)`, class: "risk-high" });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // ClasificaciÃ³n Final del Score
Â  Â  Â  Â  Â  Â  let riskLevel = "";
Â  Â  Â  Â  Â  Â  let riskClass = "";
Â  Â  Â  Â  Â  Â  if (score >= 100 || inputs.history_mi === 'yes' || inputs.history_angina === 'yes') {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = "MUY ALTO RIESGO";
Â  Â  Â  Â  Â  Â  Â  Â  riskClass = "risk-very-high";
Â  Â  Â  Â  Â  Â  } else if (score >= 60) {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = "ALTO RIESGO";
Â  Â  Â  Â  Â  Â  Â  Â  riskClass = "risk-high";
Â  Â  Â  Â  Â  Â  } else if (score >= 30) {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = "RIESGO MODERADO";
Â  Â  Â  Â  Â  Â  Â  Â  riskClass = "risk-moderate";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  riskLevel = "RIESGO BAJO";
Â  Â  Â  Â  Â  Â  Â  Â  riskClass = "risk-low";
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  score: Math.round(score),
Â  Â  Â  Â  Â  Â  Â  Â  level: riskLevel,
Â  Â  Â  Â  Â  Â  Â  Â  css_class: riskClass,
Â  Â  Â  Â  Â  Â  Â  Â  factors: riskFactors,
Â  Â  Â  Â  Â  Â  Â  Â  grip_factor_text: gripFactor.text // Texto resumen de dinamometrÃ­a
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }

Â  Â  Â  Â  // Helper para Paso 4: DinamometrÃ­a
Â  Â  Â  Â  function checkDynamometry(inputs, currentScore) {
Â  Â  Â  Â  Â  Â  const { age, gender, grip_right, grip_left } = inputs;
Â  Â  Â  Â  Â  Â  if ((!grip_right || grip_right === 0) && (!grip_left || grip_left === 0) || !age) return [currentScore, null];

Â  Â  Â  Â  Â  Â  const maxGrip = Math.max(grip_right || 0, grip_left || 0);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. Obtener rango de edad de la tabla
Â  Â  Â  Â  Â  Â  let ageRange;
Â  Â  Â  Â  Â  Â  if (age <= 29) ageRange = "20-29";
Â  Â  Â  Â  Â  Â  else if (age <= 39) ageRange = "30-39";
Â  Â  Â  Â  Â  Â  else if (age <= 49) ageRange = "40-49";
Â  Â  Â  Â  Â  Â  else if (age <= 59) ageRange = "50-59";
Â  Â  Â  Â  Â  Â  else if (age <= 69) ageRange = "60-69";
Â  Â  Â  Â  Â  Â  else ageRange = "70-99";

Â  Â  Â  Â  Â  Â  // 2. Obtener el P10 (punto de corte)
Â  Â  Â  Â  Â  Â  const p10_cutoff = DYNAMOMETRY_P10[gender === 'male' ? 'hombres' : 'mujeres'][ageRange];

Â  Â  Â  Â  Â  Â  // 3. Evaluar
Â  Â  Â  Â  Â  Â  if (maxGrip < p10_cutoff) {
Â  Â  Â  Â  Â  Â  Â  Â  const factor = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: `Baja Fuerza Muscular (DinamometrÃ­a < ${p10_cutoff} Kg)`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class: "risk-high"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  // Aumenta el score porque la sarcopenia es un factor de riesgo CV grave
Â  Â  Â  Â  Â  Â  Â  Â  return [currentScore + 15, factor];
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const factor = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: `Fuerza Muscular Normal (DinamometrÃ­a > P10)`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class: "risk-low"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  // No suma score, solo es informativo
Â  Â  Â  Â  Â  Â  Â  Â  return [currentScore, factor];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * PASO 6: Muestra los resultados en el HTML.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function generateResults_v2(inputs, metrics, riskProfile) {
Â  Â  Â  Â  Â  Â  // 1. Nivel de Riesgo Global
Â  Â  Â  Â  Â  Â  const riskDiv = document.getElementById('global-risk-result');
Â  Â  Â  Â  Â  Â  riskDiv.innerHTML = `${riskProfile.level} (Score: ${riskProfile.score})`;
Â  Â  Â  Â  Â  Â  riskDiv.className = `text-center p-4 rounded-lg font-bold text-2xl mb-4 transition duration-300 ${riskProfile.css_class}`;

Â  Â  Â  Â  Â  Â  // 2. Llenar MÃ©tricas Calculadas
Â  Â  Â  Â  Â  Â  document.getElementById('res-age').textContent = inputs.age;
Â  Â  Â  Â  Â  Â  document.getElementById('res-bmi-val').textContent = metrics.bmi;
Â  Â  Â  Â  Â  Â  document.getElementById('res-bmi-class').textContent = `(${metrics.bmi_class})`;
Â  Â  Â  Â  Â  Â  document.getElementById('res-icc-val').textContent = metrics.icc;
Â  Â  Â  Â  Â  Â  document.getElementById('res-icc-class').textContent = `(${metrics.icc_class})`;

Â  Â  Â  Â  Â  Â  document.getElementById('res-tg-hdl-val').textContent = metrics.tg_hdl;
Â  Â  Â  Â  Â  Â  document.getElementById('res-tg-hdl-class').textContent = `(${metrics.tg_hdl_class})`;
Â  Â  Â  Â  Â  Â  document.getElementById('res-chol-hdl-val').textContent = metrics.chol_hdl;
Â  Â  Â  Â  Â  Â  document.getElementById('res-chol-hdl-class').textContent = `(${metrics.chol_hdl_class})`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('res-fli-val').textContent = metrics.fli_score;
Â  Â  Â  Â  Â  Â  document.getElementById('res-fli-class').textContent = `(${metrics.fli_class})`;

Â  Â  Â  Â  Â  Â  document.getElementById('res-ipa-val').textContent = metrics.ipa;
Â  Â  Â  Â  Â  Â  document.getElementById('res-ipa-class').textContent = `(${metrics.ipa_class})`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const totalActivity = (inputs.activity_days * inputs.activity_duration) || 0;
Â  Â  Â  Â  Â  Â  document.getElementById('res-activity-class').textContent = totalActivity >= 150 ? "Activo (Cumple meta)" : "Sedentario/Insuficiente";
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('res-grip-class').textContent = riskProfile.grip_factor_text;


Â  Â  Â  Â  Â  Â  // 3. Llenar Lista de Factores de Riesgo
Â  Â  Â  Â  Â  Â  const factorsList = document.getElementById('risk-factors-list');
Â  Â  Â  Â  Â  Â  factorsList.innerHTML = ""; // Limpiar lista
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  factorsList.innerHTML = '<li class="text-green-600">Â¡Felicidades! No se detectaron factores de riesgo mayores.</li>';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  riskProfile.factors.forEach(factor => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let colorClass = "text-gray-700";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (factor.class === 'risk-very-high' || factor.class === 'risk-high') colorClass = "text-red-600 font-bold";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (factor.class === 'risk-moderate') colorClass = "text-yellow-700 font-semibold";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (factor.class === 'risk-low') colorClass = "text-green-600";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  factorsList.innerHTML += `<li class="${colorClass}">${factor.text}</li>`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 4. Llenar Recomendaciones (Personalizadas)
Â  Â  Â  Â  Â  Â  const recList = document.getElementById('recommendations-list');
Â  Â  Â  Â  Â  Â  recList.innerHTML = ""; // Limpiar lista
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Recomendaciones basadas en los peores factores
Â  Â  Â  Â  Â  Â  if (riskProfile.level === "MUY ALTO RIESGO" || riskProfile.level === "ALTO RIESGO") {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li class="font-bold text-red-700">AtenciÃ³n Prioritaria: Su perfil indica un riesgo cardiovascular elevado. Es fundamental consultar a un mÃ©dico especialista a la brevedad.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.some(f => f.text.includes("Diabetes") || f.text.includes("Prediabetes"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li>Controlar la glucosa y HbA1c es su prioridad #1. Requiere manejo mÃ©dico y un plan de alimentaciÃ³n estricto.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.some(f => f.text.includes("Tabaquismo"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li class="font-bold">El cese del tabaquismo es la intervenciÃ³n aislada mÃ¡s importante que puede hacer. Busque apoyo profesional para dejar de fumar.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.some(f => f.text.includes("Obesidad Abdominal") || f.text.includes("Sobrepeso"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li>La pÃ©rdida de peso (5-10% inicial) mejorarÃ¡ drÃ¡sticamente su presiÃ³n arterial, glucosa y lÃ­pidos. Enfoque en reducir grasa visceral.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â if (riskProfile.factors.some(f => f.text.includes("Baja Fuerza Muscular"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li>Su fuerza es baja (riesgo de sarcopenia). Se recomienda iniciar un **programa de ejercicio de fuerza** (pesas, ligas, lagartijas) 2-3 veces por semana, supervisado.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.some(f => f.text.includes("Sedentarismo"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li>Su nivel de actividad es insuficiente. Intente cumplir la meta de 150 minutos de actividad moderada (caminar rÃ¡pido) por semana.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.some(f => f.text.includes("MASLD"))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â recList.innerHTML += `<li>Su riesgo de HÃ­gado Graso es alto. La intervenciÃ³n principal es la **pÃ©rdida de peso** y la **reducciÃ³n drÃ¡stica de azÃºcares y harinas refinadas**.</li>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (recList.innerHTML === "") {
Â  Â  Â  Â  Â  Â  Â  Â  recList.innerHTML = '<li>Â¡Excelente perfil! Mantenga un estilo de vida saludable y realice chequeos preventivos anuales.</li>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


        /**
         * LÃ³gica para controlar el flujo de la pantalla de disclaimer.
         */
        function handleDisclaimerAcceptance() {
            const disclaimerDiv = document.getElementById('privacy-disclaimer');
            const appContentDiv = document.getElementById('app-content');
            const checkbox = document.getElementById('accept-checkbox');
            const startButton = document.getElementById('start-button');

            // 1. Manejo del botÃ³n de "Continuar"
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    startButton.disabled = false;
                    startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    startButton.disabled = true;
                    startButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
            });

            // 2. Manejo del clic en el botÃ³n de inicio
            startButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (checkbox.checked) {
                    // Ocultar disclaimer y mostrar la app principal
                    disclaimerDiv.classList.add('hidden');
                    appContentDiv.classList.remove('hidden');
                    window.scrollTo(0, 0);
                } else {
                    // Muestra mensaje de validaciÃ³n (aunque el botÃ³n debe estar deshabilitado)
                    const validationDiv = document.getElementById('validation-message');
                    validationDiv.textContent = "Debe aceptar el Aviso de Privacidad para continuar.";
                    validationDiv.classList.remove('hidden');
                }
            });
            
            // Asegura que la pantalla correcta se muestre al inicio.
            disclaimerDiv.classList.remove('hidden');
            appContentDiv.classList.add('hidden');
        }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * FunciÃ³n para resetear el formulario (v2)
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function resetForm() {
            // Restablece la visibilidad para volver al disclaimer
            document.getElementById('privacy-disclaimer').classList.remove('hidden');
            document.getElementById('app-content').classList.add('hidden');

            // Restablece el estado de consentimiento
            document.getElementById('accept-checkbox').checked = false;
            const startButton = document.getElementById('start-button');
            startButton.disabled = true;
            startButton.classList.add('opacity-50', 'cursor-not-allowed');

            // Vuelve al formulario y oculta los resultados
Â  Â  Â  Â  Â  Â  document.getElementById('input-form').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('results-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reset-button').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('sheet-status').classList.add('hidden');
Â  Â  Â  Â  Â  Â  
            // Limpia los campos del formulario
Â  Â  Â  Â  Â  Â  document.getElementById('calc-form').reset();
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * FunciÃ³n de copiado (v2) - Se mantiene en el script, pero no se usa
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function copyResults_v2() {
Â  Â  Â  Â  Â  Â  if (!window.lastResultData_v2) {
Â  Â  Â  Â  Â  Â  Â  Â  // Reemplazando alert()
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('validation-message').textContent = "No hay resultados para copiar. Por favor, calcula primero.";
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('validation-message').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const { inputs, metrics, riskProfile } = window.lastResultData_v2;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Generar texto plano
Â  Â  Â  Â  Â  Â  let text = `--- PERFIL DE RIESGO CARDIOMETABÃ“LICO INTEGRAL ---\n`;
Â  Â  Â  Â  Â  Â  text += `Nombre: ${inputs.full_name || 'No provisto'}\n`;
Â  Â  Â  Â  Â  Â  text += `Edad: ${inputs.age} aÃ±os\n`;
Â  Â  Â  Â  Â  Â  text += `Fecha: ${new Date().toLocaleString('es-MX', { timeZone: 'America/Mexico_City' })}\n\n`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  text += `== RIESGO GLOBAL ==\n`;
Â  Â  Â  Â  Â  Â  text += `NIVEL: ${riskProfile.level}\n`;
Â  Â  Â  Â  Â  Â  text += `SCORE: ${riskProfile.score} puntos\n\n`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  text += `== MÃ‰TRICAS CLAVE ==\n`;
Â  Â  Â  Â  Â  Â  text += `IMC: ${metrics.bmi} (${metrics.bmi_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Ãndice Cintura-Cadera (ICC): ${metrics.icc} (${metrics.icc_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Ãndice TG/HDL: ${metrics.tg_hdl} (${metrics.tg_hdl_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Ãndice Col Total/HDL: ${metrics.chol_hdl} (${metrics.chol_hdl_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Riesgo MASLD (FLI): ${metrics.fli_score} (${metrics.fli_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Ãndice TabÃ¡quico (IPA): ${metrics.ipa} (${metrics.ipa_class})\n`;
Â  Â  Â  Â  Â  Â  text += `Fuerza de Agarre: ${riskProfile.grip_factor_text}\n`;
Â  Â  Â  Â  Â  Â  text += `PresiÃ³n Arterial Usada: ${inputs.pa_used.s}/${inputs.pa_used.d} mmHg (${inputs.pa_used.source})\n\n`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  text += `== FACTORES DE RIESGO DETECTADOS ==\n`;
Â  Â  Â  Â  Â  Â  if (riskProfile.factors.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  riskProfile.factors.forEach(f => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text += `- ${f.text}\n`;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  text += `- NingÃºn factor de riesgo mayor detectado.\n`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  text += `\n== PLAN DE ACCIÃ“N RECOMENDADO ==\n`;
Â  Â  Â  Â  Â  Â  const recListItems = document.getElementById('recommendations-list').children;
Â  Â  Â  Â  Â  Â  Array.from(recListItems).forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  text += `* ${item.textContent}\n`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  text += `\n**Nota Importante:** Esta herramienta no sustituye la evaluaciÃ³n mÃ©dica profesional.`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Copiar al portapapeles
Â  Â  Â  Â  Â  Â  if (navigator.clipboard && navigator.clipboard.writeText) {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(text).then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Reemplazando alert() con un mensaje de estado temporal
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('sheet-status');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = "Â¡Resultados copiados al portapapeles!";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-blue-100 text-blue-800";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusDiv.classList.add('hidden'), 3000);

Â  Â  Â  Â  Â  Â  Â  Â  }).catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error al copiar: ', err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Reemplazando alert() con un mensaje de estado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('validation-message').textContent = "Error al copiar. Revisa la consola.";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('validation-message').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Fallback para navegadores antiguos
Â  Â  Â  Â  Â  Â  Â  Â  const textarea = document.createElement('textarea');
Â  Â  Â  Â  Â  Â  Â  Â  textarea.value = text;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(textarea);
Â  Â  Â  Â  Â  Â  Â  Â  textarea.select();
Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(textarea);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Reemplazando alert() con un mensaje de estado temporal
Â  Â  Â  Â  Â  Â  Â  Â  const statusDiv = document.getElementById('sheet-status');
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.textContent = "Â¡Resultados copiados al portapapeles! (modo fallback)";
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-blue-100 text-blue-800";
Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => statusDiv.classList.add('hidden'), 3000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


        /**
         * LÃ³gica para controlar el flujo de la pantalla de disclaimer.
         */
        function handleDisclaimerAcceptance() {
            const disclaimerDiv = document.getElementById('privacy-disclaimer');
            const appContentDiv = document.getElementById('app-content');
            const checkbox = document.getElementById('accept-checkbox');
            const startButton = document.getElementById('start-button');

            // 1. Manejo del botÃ³n de "Continuar"
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    startButton.disabled = false;
                    startButton.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    startButton.disabled = true;
                    startButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
            });

            // 2. Manejo del clic en el botÃ³n de inicio
            startButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (checkbox.checked) {
                    // Ocultar disclaimer y mostrar la app principal
                    disclaimerDiv.classList.add('hidden');
                    appContentDiv.classList.remove('hidden');
                    window.scrollTo(0, 0);
                } else {
                    // Muestra mensaje de validaciÃ³n (aunque el botÃ³n debe estar deshabilitado)
                    const validationDiv = document.getElementById('validation-message');
                    validationDiv.textContent = "Debe aceptar el Aviso de Privacidad para continuar.";
                    validationDiv.classList.remove('hidden');
                }
            });
            
            // Asegura que la pantalla correcta se muestre al inicio.
            disclaimerDiv.classList.remove('hidden');
            appContentDiv.classList.add('hidden');
        }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * FunciÃ³n para resetear el formulario (v2)
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function resetForm() {
            // Restablece la visibilidad para volver al disclaimer
            document.getElementById('privacy-disclaimer').classList.remove('hidden');
            document.getElementById('app-content').classList.add('hidden');

            // Restablece el estado de consentimiento
            document.getElementById('accept-checkbox').checked = false;
            const startButton = document.getElementById('start-button');
            startButton.disabled = true;
            startButton.classList.add('opacity-50', 'cursor-not-allowed');

            // Vuelve al formulario y oculta los resultados
Â  Â  Â  Â  Â  Â  document.getElementById('input-form').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('results-section').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('reset-button').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('sheet-status').classList.add('hidden');
Â  Â  Â  Â  Â  Â  
            // Limpia los campos del formulario
Â  Â  Â  Â  Â  Â  document.getElementById('calc-form').reset();
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Inicializador ---
Â  Â  Â  Â  // Asegura que el DOM estÃ© cargado antes de asignar los botones
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â Â 
            // ** Inicializa la lÃ³gica del Aviso de Privacidad **
            handleDisclaimerAcceptance();

Â  Â  Â  Â  Â  Â  // Asigna la funciÃ³n v2 (ahora async) al botÃ³n de cÃ¡lculo
Â  Â  Â  Â  Â  Â  const calcButton = document.getElementById('calculate-button');
Â  Â  Â  Â  Â  Â  if (calcButton) {
Â  Â  Â  Â  Â  Â  Â  Â  calcButton.onclick = async (e) => { // Importante: Hacer la funciÃ³n async
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); // Previene que el formulario se envÃ­e
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await calculateRisk_v2();
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Asigna la funciÃ³n de reseteo
Â  Â  Â  Â  Â  Â  const resetButton = document.getElementById('reset-button');
Â  Â  Â  Â  Â  Â  if (resetButton) {
Â  Â  Â  Â  Â  Â  Â  Â  resetButton.onclick = resetForm;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Asigna la funciÃ³n de impresiÃ³n
Â  Â  Â  Â  Â  Â  const printButton = document.getElementById('print-button');
Â  Â  Â  Â  Â  Â  if (printButton) {
Â  Â  Â  Â  Â  Â  Â  Â  printButton.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); // Prevenir cualquier acciÃ³n default del botÃ³n
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.print();
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  </script>
Â  Â Â 
</body>
</html>
